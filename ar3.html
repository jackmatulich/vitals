<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>AR Ultrasound Probe</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	
	<!-- Fixed script sources that were working with Hiro marker -->
	<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
	<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
	
	<style>
		.control-panel {
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			background-color: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 10px;
			z-index: 999;
		}
		.slider-group {
			display: flex;
			align-items: center;
			margin: 5px 0;
		}
		.slider-label {
			width: 100px;
			margin-right: 10px;
		}
		.slider {
			flex-grow: 1;
		}
		.value-display {
			width: 60px;
			text-align: right;
			margin-left: 10px;
		}
		h3 {
			margin: 5px 0;
		}
		#status-message {
			position: fixed;
			top: 10px;
			width: 100%;
			background-color: rgba(0,0,0,0.7);
			color: white;
			text-align: center;
			padding: 10px;
			z-index: 1000;
		}
	</style>
</head>

<body style="margin: 0; overflow: hidden;">
	<div id="status-message">Looking for cube marker (kanji or A/B/C/D sides)...</div>
	
	<!-- A-Frame Scene -->
	<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono;">
		<a-assets>
			<a-asset-item id="probe-model" src="https://cdn.tinyglb.com/models/2ff293225d4a4ef3878d6a631fce6dbc.glb"></a-asset-item>
		</a-assets>
		
		<!-- Kanji marker from the magic-cube example -->
		<a-marker type="pattern" url="https://stemkoski.github.io/AR-Examples/data/kanji.patt" id="kanji-marker">
			<a-entity
				id="kanji-probe"
				gltf-model="#probe-model"
				position="0.2 0 0"
				rotation="90 180 0"
				scale="40 40 40">
			</a-entity>
		</a-marker>
		
		<!-- A marker from the magic-cube example -->
		<a-marker type="pattern" url="https://stemkoski.github.io/AR-Examples/data/letterA.patt" id="a-marker">
			<a-entity
				id="a-probe"
				gltf-model="#probe-model"
				position="0.2 0 0"
				rotation="90 180 0"
				scale="40 40 40">
			</a-entity>
		</a-marker>
		
		<!-- B marker from the magic-cube example -->
		<a-marker type="pattern" url="https://stemkoski.github.io/AR-Examples/data/letterB.patt" id="b-marker">
			<a-entity
				id="b-probe"
				gltf-model="#probe-model"
				position="0.2 0 0"
				rotation="90 180 0"
				scale="40 40 40">
			</a-entity>
		</a-marker>
		
		<!-- C marker from the magic-cube example -->
		<a-marker type="pattern" url="https://stemkoski.github.io/AR-Examples/data/letterC.patt" id="c-marker">
			<a-entity
				id="c-probe"
				gltf-model="#probe-model"
				position="0.2 0 0"
				rotation="90 180 0"
				scale="40 40 40">
			</a-entity>
		</a-marker>
		
		<!-- D marker from the magic-cube example -->
		<a-marker type="pattern" url="https://stemkoski.github.io/AR-Examples/data/letterD.patt" id="d-marker">
			<a-entity
				id="d-probe"
				gltf-model="#probe-model"
				position="0.2 0 0"
				rotation="90 180 0"
				scale="40 40 40">
			</a-entity>
		</a-marker>
		
		<a-entity camera></a-entity>
	</a-scene>
	
	<div class="control-panel">
		<h3>Ultrasound Probe Controls</h3>
		
		<div class="slider-group">
			<div class="slider-label">Position X</div>
			<input type="range" min="-3" max="3" step="0.1" value="0.2" class="slider" id="posX">
			<div class="value-display" id="posXValue">0.2</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Position Y</div>
			<input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posY">
			<div class="value-display" id="posYValue">0</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Position Z</div>
			<input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posZ">
			<div class="value-display" id="posZValue">0</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Rotation X</div>
			<input type="range" min="0" max="360" step="1" value="90" class="slider" id="rotX">
			<div class="value-display" id="rotXValue">90</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Rotation Y</div>
			<input type="range" min="0" max="360" step="1" value="180" class="slider" id="rotY">
			<div class="value-display" id="rotYValue">180</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Rotation Z</div>
			<input type="range" min="0" max="360" step="1" value="0" class="slider" id="rotZ">
			<div class="value-display" id="rotZValue">0</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Scale</div>
			<input type="range" min="1" max="100" step="1" value="40" class="slider" id="scale">
			<div class="value-display" id="scaleValue">40</div>
		</div>
	</div>

<script>
// Wait for document to be ready
document.addEventListener('DOMContentLoaded', function() {
    const statusMessage = document.getElementById('status-message');
    
    // Get all markers
    const kanjiMarker = document.getElementById('kanji-marker');
    const aMarker = document.getElementById('a-marker');
    const bMarker = document.getElementById('b-marker');
    const cMarker = document.getElementById('c-marker');
    const dMarker = document.getElementById('d-marker');
    
    // Get all probes
    const kanjiProbe = document.getElementById('kanji-probe');
    const aProbe = document.getElementById('a-probe');
    const bProbe = document.getElementById('b-probe');
    const cProbe = document.getElementById('c-probe');
    const dProbe = document.getElementById('d-probe');
    
    // Current active probe & marker for slider control
    let activeProbe = null;
    let markerVisible = false;
    
    // Function to handle when any marker is found
    function markerFound(markerId) {
        markerVisible = true;
        statusMessage.textContent = markerId + ' marker found! Displaying model.';
        statusMessage.style.backgroundColor = 'rgba(0, 128, 0, 0.7)';
        setTimeout(function() {
            statusMessage.style.display = 'none';
        }, 3000);
    }
    
    // Function to handle when all markers are lost
    function allMarkersLost() {
        if (!markerVisible) {
            statusMessage.style.display = 'block';
            statusMessage.textContent = 'Marker lost. Please show any side of the cube marker.';
            statusMessage.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        }
    }
    
    // Set up marker found/lost events for kanji marker
    if (kanjiMarker) {
        kanjiMarker.addEventListener('markerFound', function() {
            activeProbe = kanjiProbe;
            markerFound('Kanji');
        });
        
        kanjiMarker.addEventListener('markerLost', function() {
            markerVisible = aMarker.object3D.visible || bMarker.object3D.visible || 
                           cMarker.object3D.visible || dMarker.object3D.visible;
            allMarkersLost();
        });
    }
    
    // Set up marker found/lost events for A marker
    if (aMarker) {
        aMarker.addEventListener('markerFound', function() {
            activeProbe = aProbe;
            markerFound('A');
        });
        
        aMarker.addEventListener('markerLost', function() {
            markerVisible = kanjiMarker.object3D.visible || bMarker.object3D.visible || 
                           cMarker.object3D.visible || dMarker.object3D.visible;
            allMarkersLost();
        });
    }
    
    // Set up marker found/lost events for B marker
    if (bMarker) {
        bMarker.addEventListener('markerFound', function() {
            activeProbe = bProbe;
            markerFound('B');
        });
        
        bMarker.addEventListener('markerLost', function() {
            markerVisible = kanjiMarker.object3D.visible || aMarker.object3D.visible || 
                           cMarker.object3D.visible || dMarker.object3D.visible;
            allMarkersLost();
        });
    }
    
    // Set up marker found/lost events for C marker
    if (cMarker) {
        cMarker.addEventListener('markerFound', function() {
            activeProbe = cProbe;
            markerFound('C');
        });
        
        cMarker.addEventListener('markerLost', function() {
            markerVisible = kanjiMarker.object3D.visible || aMarker.object3D.visible || 
                           bMarker.object3D.visible || dMarker.object3D.visible;
            allMarkersLost();
        });
    }
    
    // Set up marker found/lost events for D marker
    if (dMarker) {
        dMarker.addEventListener('markerFound', function() {
            activeProbe = dProbe;
            markerFound('D');
        });
        
        dMarker.addEventListener('markerLost', function() {
            markerVisible = kanjiMarker.object3D.visible || aMarker.object3D.visible || 
                           bMarker.object3D.visible || cMarker.object3D.visible;
            allMarkersLost();
        });
    }
    
    // Function to update all probes with the same position
    function updateAllProbesPosition(x, y, z) {
        const position = { x: x, y: y, z: z };
        
        if (kanjiProbe) kanjiProbe.setAttribute('position', position);
        if (aProbe) aProbe.setAttribute('position', position);
        if (bProbe) bProbe.setAttribute('position', position);
        if (cProbe) cProbe.setAttribute('position', position);
        if (dProbe) dProbe.setAttribute('position', position);
    }
    
    // Function to update all probes with the same rotation
    function updateAllProbesRotation(x, y, z) {
        const rotation = { x: x, y: y, z: z };
        
        if (kanjiProbe) kanjiProbe.setAttribute('rotation', rotation);
        if (aProbe) aProbe.setAttribute('rotation', rotation);
        if (bProbe) bProbe.setAttribute('rotation', rotation);
        if (cProbe) cProbe.setAttribute('rotation', rotation);
        if (dProbe) dProbe.setAttribute('rotation', rotation);
    }
    
    // Function to update all probes with the same scale
    function updateAllProbesScale(scale) {
        const scaleObj = { x: scale, y: scale, z: scale };
        
        if (kanjiProbe) kanjiProbe.setAttribute('scale', scaleObj);
        if (aProbe) aProbe.setAttribute('scale', scaleObj);
        if (bProbe) bProbe.setAttribute('scale', scaleObj);
        if (cProbe) cProbe.setAttribute('scale', scaleObj);
        if (dProbe) dProbe.setAttribute('scale', scaleObj);
    }
    
    // Set up slider controls
    
    // Position X slider
    document.getElementById('posX').addEventListener('input', function() {
        const value = parseFloat(this.value);
        updateAllProbesPosition(
            value,
            parseFloat(document.getElementById('posY').value),
            parseFloat(document.getElementById('posZ').value)
        );
        document.getElementById('posXValue').textContent = value.toFixed(1);
    });
    
    // Position Y slider
    document.getElementById('posY').addEventListener('input', function() {
        const value = parseFloat(this.value);
        updateAllProbesPosition(
            parseFloat(document.getElementById('posX').value),
            value,
            parseFloat(document.getElementById('posZ').value)
        );
        document.getElementById('posYValue').textContent = value.toFixed(1);
    });
    
    // Position Z slider
    document.getElementById('posZ').addEventListener('input', function() {
        const value = parseFloat(this.value);
        updateAllProbesPosition(
            parseFloat(document.getElementById('posX').value),
            parseFloat(document.getElementById('posY').value),
            value
        );
        document.getElementById('posZValue').textContent = value.toFixed(1);
    });
    
    // Rotation X slider
    document.getElementById('rotX').addEventListener('input', function() {
        const value = parseInt(this.value);
        updateAllProbesRotation(
            value,
            parseInt(document.getElementById('rotY').value),
            parseInt(document.getElementById('rotZ').value)
        );
        document.getElementById('rotXValue').textContent = value;
    });
    
    // Rotation Y slider
    document.getElementById('rotY').addEventListener('input', function() {
        const value = parseInt(this.value);
        updateAllProbesRotation(
            parseInt(document.getElementById('rotX').value),
            value,
            parseInt(document.getElementById('rotZ').value)
        );
        document.getElementById('rotYValue').textContent = value;
    });
    
    // Rotation Z slider
    document.getElementById('rotZ').addEventListener('input', function() {
        const value = parseInt(this.value);
        updateAllProbesRotation(
            parseInt(document.getElementById('rotX').value),
            parseInt(document.getElementById('rotY').value),
            value
        );
        document.getElementById('rotZValue').textContent = value;
    });
    
    // Scale slider
    document.getElementById('scale').addEventListener('input', function() {
        const value = parseInt(this.value);
        updateAllProbesScale(value);
        document.getElementById('scaleValue').textContent = value;
    });
});
</script>
</body>
</html>