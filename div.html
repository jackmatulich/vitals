<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="div.css">
  <script src="//cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="//dweet.io/client/dweet.io.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"> <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  <title>Document</title>

<style>
  #qrcode {
    width:100%;
    height:100%;
  
    margin:auto;
  }
  
  .modal-dialog-full-width {
          width: 100% !important;
          height: 100% !important;
          margin: 0 !important;
          padding: 0 !important;
          max-width:none !important;
  
      }
  
      .modal-content-full-width  {
          height: auto !important;
          min-height: 100% !important;
          border-radius: 0 !important;
          background-color: #ececec !important 
      }
  
      .modal-header-full-width  {
          border-bottom: 1px solid #9ea2a2 !important;
      }
  
      .modal-footer-full-width  {
          border-top: 1px solid #9ea2a2 !important;
  }
  
</style>


</head>

<body>



  <!-- Time Row -->
  <div class="row time">

    <button type="button" class="btn btn-primary" style="border:#303030;background:#303030;text-align: center;margin:auto" data-toggle="modal" data-target="#myModal">Control Link</button>
    <div class="modal fade" id="myModal">
       <div class="modal-dialog modal-xl modal-dialog-centered">
           <div class="modal-content">
               <div class="modal-header">
                  <h4 class="modal-title" id="qrlink" style="color:black;text-align: center;margin:auto"></h4>
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
               </div>
              <div class="modal-body">
                       
    
    <div  style="display: flex; justify-content: center; text-align: center;" id="qrcode"></div>
              </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                
              </div>
           </div>
      </div>
    </div>


  </div>



  <!-- ECG Row -->
  <div class="row double">
    <!-- Waveform -->
    <div class="waveform">
      <canvas  id="ecg" width ="2500"height="200"></canvas>
    </div>
    <!-- Numerics -->
    <div class="numerics">

      <!-- Numeric Title -->
      <div class="numericstitle">
        ECG
      </div>
      <!-- Number -->
      <div id= "HR" class="number ecg">

      </div>
    </div>
  </div>

  <!-- spO2 Row -->
  <div class="row single">
    <!-- Waveform -->
    <div class="waveform">

    </div>
    <!-- Numerics -->
    <div class="numerics">

      <!-- Numeric Title -->
      <div class="numericstitle">
        SPO2
      </div>
      <!-- Number -->
      <div class="number spo2"> 98

      </div>
    </div>
  </div>


  <!-- IABP Row -->
  <div class="row double">
    <!-- Waveform -->
    <div class="waveform">

    </div>
    <!-- Numerics -->
    <div class="numerics">
   
      <!-- Numeric Title -->
      <div class="numericstitle">
        IABP
      </div>
      <!-- Number -->
      <div class="number art"> 120/60<div class="map">(80)</div>

      </div>
    </div>
  </div>


  <!-- etCO2 -->
  <div class="row single">
    <!-- Waveform -->
    <div class="waveform">

    </div>
    <!-- Numerics -->
    <div class="numerics">

      <!-- Numeric Title -->
      <div class="numericstitle">
        etCO2
      </div>
      <!-- Number -->
      <div class="number co2">35

      </div>
    </div>
  </div>


  <!-- Lower Number Row -->
  <div class="row single">
    <div class="nibpandtemp">
      <div class="numericstitle">
        NIBP
      </div>
      <div class="number white"> 120/60 (80)

      </div>

    </div>
    <div class="nibpandtemp">
      <div class="numericstitle">
        Temp
      </div>
      <div class="number white">37.8

      </div>

    </div>
    <div class="timer">
      <div class="numericstitle">
        Timer
      </div>
      <div class="number white">0000

      </div>

    </div>
    <div class="numerics">
      <div class="numericstitle">
        Resp Rate
      </div>
      <div class="number resp">12

      </div>

    </div>
  </div>



  <!-- Buttons -->
  <div class="row buttons">
    <div class="button power"><div class="valign">POWER</div></div>
    <div class="button"><div class="valign">START</div></div>
    <div class="button"><div class="valign">CYCLE</div></div>
    <div class="button"><div class="valign">5 MIN</div></div>
    <div class="button"><div class="valign">12 L</div></div>
    <div class="button"><div class="valign">MENU</div></div>
    <div class="button silence"><div class="valign">SHH</div>
  </div>

  <script>
   var rate=200;
   
   var EcgDataSR=["1,2,4,5,7,9,11,14,17,21,23,25,27,28,29,30,29,28,27,26,25,23,21,19,14,11,8,6,4,3,2,1,0,0,1,1,1,0,0,0,1,1,1,1,2,2,1,1,0,0,0,0,1,2,3,6,7,8,9,10,12,14,16,19,22,25,30,35,40,60,80,100,5,4,3,1,-3,-7,-10,-13,-15,-11,-5,-2,0,0,0,1,1,2,2,2,1,1,0,0,0,0,1,1,1,1,2,2,2,3,3,3,2,2,3,3,3,3,4,6,8,10,14,17,20,23,26,29,31,33,35,37,39,40,41,41,41,42,42,42,41,41,41,40,40,40,39,39,39,38,38,36,34,32,30,27,24,21,18,15,13,13,9,9,5,5,5,3,2,1"];
    var EcgData=["0,3,6,9,12,15,18,21,24,27,30,31,33,33,34,36,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,97,98,99,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,75,76,77,78,76,75,60,50,40,30,25,15,10,5,0"];

   document.getElementById("HR").innerHTML = rate;

    var ecgarr = EcgData[0].split(',');


beatlength=ecgarr.length;
console.log("ecgbeatwlength:");
console.log(beatlength);
var liminal=(2500/(rate/10))-beatlength;
console.log("liminal:");
console.log(liminal);
var baseline = Array.from({length: beatlength}, () => Math.floor(Math.random() * 5));
var displayrhythm = ecgarr.concat(baseline);


    var canvas = document.getElementById("ecg");
    var ctx = ecg.getContext("2d");
    var w = ecg.width,
    h = ecg.height,
    speed = 2,
    scanBarWidth = 20,
    i=0,
    data = displayrhythm,
    color='#00ff00';
    var px = 0;
    var opx = 0;
    var py = h/2; /* should equal 50 if height 100px */ 
    var opy = py; /* should equal 50 if height 100px */ 
    ctx.strokeStyle = color;
    ctx.lineWidth = 5;
    ctx.setTransform(1,0,0,-1,0,h);
drawWave();

    function drawWave() {
      
      
      beatlength=ecgarr.length+(Math.floor(Math.random() * 5));
      liminal=(2500/(rate/10))-beatlength;
      console.log("rate:");
      console.log(rate);
      baseline = Array.from({length: beatlength}, () => Math.floor(Math.random() * 5));
      displayrhythm = ecgarr.concat(baseline);

      data = displayrhythm;


       px += speed;  /* adds the value to the right to the variable on the left px(0)+speed (1)=0 */ 
            ctx.clearRect( px,0, scanBarWidth, h);/* (x coord of upper left, y coord of upper left, width in px, heigh in px) */ 
            ctx.beginPath();/* starts the line OR resets */ 
            ctx.moveTo( opx,  opy);/* moves point to XY */ 
            ctx.lineJoin= 'round';/* rounds the join */ 
            py=(data[++i>=data.length? i=0 : i++])/1+30; /* and */ 
            ctx.lineTo(px, py);/* and */ 
            ctx.stroke();/* and */ 
             opx = px;/* and */ 
            opy = py;/* and */ 
            if (opx > w) {px = opx = -speed;}/* and */ 


             requestAnimationFrame(drawWave);/* and */ 
    }







    let characters = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'
let result = ''
let length = 4 // Customize the length here.
for (let i = length; i > 0; --i) result += characters[Math.round(Math.random() * (characters.length - 1))]
console.log(result)
ucode=result;
console.log("ucode:"+ucode);
// code.innerHTML =result;
const link="sim.ninja/control/?"+ucode;
var qrlink= document.getElementById('qrlink');
qrlink.innerHTML =link;

new QRCode(document.getElementById("qrcode"),"https://"+link);


  dweetio.listen_for(ucode, function(dweet){
   
    dweetio.get_latest_dweet_for(ucode, function(err, dweet){

var dweet = dweet[0]; // Dweet is always an array of 1


console.log("dweet logged"); // The generated name

rate=parseInt(dweet.content["hr"]);
document.getElementById("HR").innerHTML = rate;

 
});

console.log(hr);
});








</script>


</body>

</html>