<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Ultrasound Probe Viewer</title>
    <meta name="description" content="AR Ultrasound Probe Viewer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://stemkoski.github.io/AR-Examples/js/aframe-ar-nft.js"></script>
    <script>
        // Register a component to change the color of the cube
        AFRAME.registerComponent('markerhandler', {
            init: function() {
                this.el.sceneEl.addEventListener('markerFound', () => {
                    console.log('Marker found');
                    document.getElementById('marker-message').style.display = 'none';
                });
                this.el.sceneEl.addEventListener('markerLost', () => {
                    console.log('Marker lost');
                    document.getElementById('marker-message').style.display = 'block';
                });
            }
        });
    </script>
    <style>
        .control-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            font-family: Arial, sans-serif;
        }
        .slider-group {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .slider-label {
            width: 100px;
            margin-right: 10px;
        }
        .slider {
            flex-grow: 1;
        }
        .value-display {
            width: 60px;
            text-align: right;
            margin-left: 10px;
        }
        h3 {
            margin: 5px 0;
        }
        #loading-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(0,0,0,0.7);
            color: white;
            text-align: center;
            padding: 10px;
            z-index: 1000;
        }
        #marker-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.7);
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div id="loading-message">Loading camera, please wait...</div>
    <div id="marker-message">Looking for marker cube. Use the same marker cube as in the magic-cube example.</div>
    
    <!-- Using the same marker type as in magic-cube.html (pattern matching) -->
    <a-scene 
        embedded 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono; patternRatio: 0.75;"
        markerhandler>
        
        <a-assets>
            <a-asset-item id="probe-model" src="https://cdn.tinyglb.com/models/2ff293225d4a4ef3878d6a631fce6dbc.glb"></a-asset-item>
        </a-assets>

        <!-- Using the same pattern marker as in magic-cube.html -->
        <a-marker type="pattern" url="https://stemkoski.github.io/AR-Examples/data/pattern-kanji.patt" id="cube-marker">
            <a-entity
                id="ultrasound-probe"
                name="Ultrasound Probe"
                gltf-model="#probe-model"
                position="0.2 0 0"
                rotation="90 180 0"
                scale="40 40 40">
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <div class="control-panel">
        <h3>Ultrasound Probe Controls</h3>
        
        <div class="slider-group">
            <div class="slider-label">Position X</div>
            <input type="range" min="-3" max="3" step="0.1" value="0.2" class="slider" id="posX">
            <div class="value-display" id="posXValue">0.2</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Y</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posY">
            <div class="value-display" id="posYValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Z</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posZ">
            <div class="value-display" id="posZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation X</div>
            <input type="range" min="0" max="360" step="1" value="90" class="slider" id="rotX">
            <div class="value-display" id="rotXValue">90</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Y</div>
            <input type="range" min="0" max="360" step="1" value="180" class="slider" id="rotY">
            <div class="value-display" id="rotYValue">180</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Z</div>
            <input type="range" min="0" max="360" step="1" value="0" class="slider" id="rotZ">
            <div class="value-display" id="rotZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Scale</div>
            <input type="range" min="1" max="100" step="1" value="40" class="slider" id="scale">
            <div class="value-display" id="scaleValue">40</div>
        </div>
    </div>

    <div class="control-panel">
        <h3>Ultrasound Probe Controls</h3>
        
        <div class="slider-group">
            <div class="slider-label">Position X</div>
            <input type="range" min="-3" max="3" step="0.1" value="0.2" class="slider" id="posX">
            <div class="value-display" id="posXValue">0.2</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Y</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posY">
            <div class="value-display" id="posYValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Z</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posZ">
            <div class="value-display" id="posZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation X</div>
            <input type="range" min="0" max="360" step="1" value="90" class="slider" id="rotX">
            <div class="value-display" id="rotXValue">90</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Y</div>
            <input type="range" min="0" max="360" step="1" value="180" class="slider" id="rotY">
            <div class="value-display" id="rotYValue">180</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Z</div>
            <input type="range" min="0" max="360" step="1" value="0" class="slider" id="rotZ">
            <div class="value-display" id="rotZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Scale</div>
            <input type="range" min="1" max="100" step="1" value="40" class="slider" id="scale">
            <div class="value-display" id="scaleValue">40</div>
        </div>
    </div>

    <script>
        // Get references to the model and all sliders
        const probeModel = document.getElementById('ultrasound-probe');
        
        // Position sliders
        const posXSlider = document.getElementById('posX');
        const posYSlider = document.getElementById('posY');
        const posZSlider = document.getElementById('posZ');
        
        // Rotation sliders
        const rotXSlider = document.getElementById('rotX');
        const rotYSlider = document.getElementById('rotY');
        const rotZSlider = document.getElementById('rotZ');
        
        // Scale slider
        const scaleSlider = document.getElementById('scale');
        
        // Value displays
        const posXValue = document.getElementById('posXValue');
        const posYValue = document.getElementById('posYValue');
        const posZValue = document.getElementById('posZValue');
        const rotXValue = document.getElementById('rotXValue');
        const rotYValue = document.getElementById('rotYValue');
        const rotZValue = document.getElementById('rotZValue');
        const scaleValue = document.getElementById('scaleValue');
        
        // Update position X
        posXSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            probeModel.setAttribute('position', {
                x: value,
                y: parseFloat(posYSlider.value),
                z: parseFloat(posZSlider.value)
            });
            posXValue.textContent = value.toFixed(1);
        });
        
        // Update position Y
        posYSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            probeModel.setAttribute('position', {
                x: parseFloat(posXSlider.value),
                y: value,
                z: parseFloat(posZSlider.value)
            });
            posYValue.textContent = value.toFixed(1);
        });
        
        // Update position Z
        posZSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            probeModel.setAttribute('position', {
                x: parseFloat(posXSlider.value),
                y: parseFloat(posYSlider.value),
                z: value
            });
            posZValue.textContent = value.toFixed(1);
        });
        
        // Update rotation X
        rotXSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('rotation', {
                x: value,
                y: parseInt(rotYSlider.value),
                z: parseInt(rotZSlider.value)
            });
            rotXValue.textContent = value;
        });
        
        // Update rotation Y
        rotYSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('rotation', {
                x: parseInt(rotXSlider.value),
                y: value,
                z: parseInt(rotZSlider.value)
            });
            rotYValue.textContent = value;
        });
        
        // Update rotation Z
        rotZSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('rotation', {
                x: parseInt(rotXSlider.value),
                y: parseInt(rotYSlider.value),
                z: value
            });
            rotZValue.textContent = value;
        });
        
        // Update scale (all dimensions)
        scaleSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('scale', {
                x: value,
                y: value,
                z: value
            });
            scaleValue.textContent = value;
        });
    </script>
    <script>
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to the model and all sliders
            const probeModel = document.getElementById('ultrasound-probe');
            const hitoMarker = document.getElementById('hiro-marker');
            const markerMessage = document.getElementById('marker-message');
            
            // Position sliders
            const posXSlider = document.getElementById('posX');
            const posYSlider = document.getElementById('posY');
            const posZSlider = document.getElementById('posZ');
            
            // Rotation sliders
            const rotXSlider = document.getElementById('rotX');
            const rotYSlider = document.getElementById('rotY');
            const rotZSlider = document.getElementById('rotZ');
            
            // Scale slider
            const scaleSlider = document.getElementById('scale');
            
            // Value displays
            const posXValue = document.getElementById('posXValue');
            const posYValue = document.getElementById('posYValue');
            const posZValue = document.getElementById('posZValue');
            const rotXValue = document.getElementById('rotXValue');
            const rotYValue = document.getElementById('rotYValue');
            const rotZValue = document.getElementById('rotZValue');
            const scaleValue = document.getElementById('scaleValue');
            
            // Scene and camera initialization events
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('loaded', function() {
                console.log("Scene loaded");
                document.getElementById('loading-message').style.display = 'none';
                
                scene.addEventListener('camera-init', function() {
                    console.log("Camera initialized");
                });
            });
            
            // Marker found/lost events
            if (hitoMarker) {
                hitoMarker.addEventListener('markerFound', function() {
                    console.log("Marker found");
                    markerMessage.style.display = 'none';
                });
                
                hitoMarker.addEventListener('markerLost', function() {
                    console.log("Marker lost");
                    markerMessage.style.display = 'block';
                });
            }
            
            // Fallback timeout to hide loading message
            setTimeout(function() {
                document.getElementById('loading-message').style.display = 'none';
            }, 5000);
            
            // Update position X
            if (posXSlider) {
                posXSlider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    probeModel.setAttribute('position', {
                        x: value,
                        y: parseFloat(posYSlider.value),
                        z: parseFloat(posZSlider.value)
                    });
                    posXValue.textContent = value.toFixed(1);
                });
            }
            
            // Update position Y
            if (posYSlider) {
                posYSlider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    probeModel.setAttribute('position', {
                        x: parseFloat(posXSlider.value),
                        y: value,
                        z: parseFloat(posZSlider.value)
                    });
                    posYValue.textContent = value.toFixed(1);
                });
            }
            
            // Update position Z
            if (posZSlider) {
                posZSlider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    probeModel.setAttribute('position', {
                        x: parseFloat(posXSlider.value),
                        y: parseFloat(posYSlider.value),
                        z: value
                    });
                    posZValue.textContent = value.toFixed(1);
                });
            }
            
            // Update rotation X
            if (rotXSlider) {
                rotXSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('rotation', {
                        x: value,
                        y: parseInt(rotYSlider.value),
                        z: parseInt(rotZSlider.value)
                    });
                    rotXValue.textContent = value;
                });
            }
            
            // Update rotation Y
            if (rotYSlider) {
                rotYSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('rotation', {
                        x: parseInt(rotXSlider.value),
                        y: value,
                        z: parseInt(rotZSlider.value)
                    });
                    rotYValue.textContent = value;
                });
            }
            
            // Update rotation Z
            if (rotZSlider) {
                rotZSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('rotation', {
                        x: parseInt(rotXSlider.value),
                        y: parseInt(rotYSlider.value),
                        z: value
                    });
                    rotZValue.textContent = value;
                });
            }
            
            // Update scale (all dimensions)
            if (scaleSlider) {
                scaleSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('scale', {
                        x: value,
                        y: value,
                        z: value
                    });
                    scaleValue.textContent = value;
                });
            }
        });
    </script>
</body>
</html>