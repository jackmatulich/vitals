<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>AR Ultrasound Probe</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<script src="https://stemkoski.github.io/AR-Examples/vendor/three.js/build/three.min.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/three.js/examples/js/libs/stats.min.js"></script>
	<!-- include jsartookit -->
	<script src="https://stemkoski.github.io/AR-Examples/vendor/ar.js/build/artoolkit.min.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/ar.js/js/threex/threex-artoolkitsource.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/ar.js/build/artoolkit.api.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/ar.js/js/threex/threex-artoolkitcontext.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/ar.js/js/threex/threex-arbasecontrols.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/ar.js/js/threex/threex-armarkercontrols.js"></script>
	<script src="https://stemkoski.github.io/AR-Examples/vendor/three.js/examples/js/loaders/GLTFLoader.js"></script>
	<style>
		body {
			margin : 0px;
			overflow: hidden;
			font-family: Monospace;
		}
		#info {
			position: absolute;
			top: 0px;
			width: 100%;
			padding: 5px;
			text-align:center;
			color: #ffff00
		}
		#info a {
			color: #ffff00;
			text-decoration: none;
		}
		#info a:hover {
			text-decoration: underline;
		}
		.control-panel {
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			background-color: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 10px;
			z-index: 999;
		}
		.slider-group {
			display: flex;
			align-items: center;
			margin: 5px 0;
		}
		.slider-label {
			width: 100px;
			margin-right: 10px;
		}
		.slider {
			flex-grow: 1;
		}
		.value-display {
			width: 60px;
			text-align: right;
			margin-left: 10px;
		}
		h3 {
			margin: 5px 0;
		}
	</style>
</head>

<body>
	<div style="position: absolute; top: 10px; width: 100%; text-align: center; z-index: 100; color:white; background-color: rgba(0,0,0,0.7); padding: 5px;">
		AR Ultrasound Probe - Place Kanji marker in view
	</div>
	
	<div class="control-panel">
		<h3>Ultrasound Probe Controls</h3>
		
		<div class="slider-group">
			<div class="slider-label">Position X</div>
			<input type="range" min="-3" max="3" step="0.1" value="0.2" class="slider" id="posX">
			<div class="value-display" id="posXValue">0.2</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Position Y</div>
			<input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posY">
			<div class="value-display" id="posYValue">0</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Position Z</div>
			<input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posZ">
			<div class="value-display" id="posZValue">0</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Rotation X</div>
			<input type="range" min="0" max="360" step="1" value="90" class="slider" id="rotX">
			<div class="value-display" id="rotXValue">90</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Rotation Y</div>
			<input type="range" min="0" max="360" step="1" value="180" class="slider" id="rotY">
			<div class="value-display" id="rotYValue">180</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Rotation Z</div>
			<input type="range" min="0" max="360" step="1" value="0" class="slider" id="rotZ">
			<div class="value-display" id="rotZValue">0</div>
		</div>
		
		<div class="slider-group">
			<div class="slider-label">Scale</div>
			<input type="range" min="1" max="100" step="1" value="40" class="slider" id="scale">
			<div class="value-display" id="scaleValue">40</div>
		</div>
	</div>

<script>
// Copy of magic-cube.html script with ultrasound probe modifications

var scene, camera, renderer, clock, deltaTime, totalTime;
var arToolkitSource, arToolkitContext;
var markerRoot1;
var mesh1;
var probeModel;

// Initialize everything
initialize();
animate();

function initialize() {
	scene = new THREE.Scene();
	camera = new THREE.Camera();
	scene.add(camera);
	
	renderer = new THREE.WebGLRenderer({
		antialias: true,
		alpha: true
	});
	renderer.setClearColor(new THREE.Color('lightgrey'), 0);
	renderer.setSize(1280, 960); // Use a fixed size initially
	renderer.domElement.style.position = 'absolute';
	renderer.domElement.style.top = '0px';
	renderer.domElement.style.left = '0px';
	document.body.appendChild(renderer.domElement);
	
	clock = new THREE.Clock();
	deltaTime = 0;
	totalTime = 0;
	
	// Setup AR toolkit source (webcam)
	arToolkitSource = new THREEx.ArToolkitSource({
		sourceType: 'webcam',
	});
	
	// Handle resize
	arToolkitSource.init(function onReady() {
		// Resize everything once source is initialized
		onResize();
	});
	
	// Add window resize listener
	window.addEventListener('resize', function() {
		onResize();
	});
	
	function onResize() {
		arToolkitSource.onResizeElement();
		arToolkitSource.copyElementSizeTo(renderer.domElement);
		if (arToolkitContext.arController !== null) {
			arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas);
		}
	}
	
	// Setup AR context
	arToolkitContext = new THREEx.ArToolkitContext({
		cameraParametersUrl: 'https://stemkoski.github.io/AR-Examples/data/camera_para.dat',
		detectionMode: 'mono',
	});
	
	// Copy projection matrix once context is initialized
	arToolkitContext.init(function onCompleted() {
		camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
	});
	
	// Create marker
	markerRoot1 = new THREE.Group();
	scene.add(markerRoot1);
	
	// Setup marker controls
	var markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
		type: 'pattern',
		patternUrl: "https://stemkoski.github.io/AR-Examples/data/kanji.patt",
	});
	
	// Add ambient light
	var light = new THREE.AmbientLight(0xffffff);
	scene.add(light);
	
	// Add directional light
	var directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
	directionalLight.position.set(10, 15, 10);
	scene.add(directionalLight);
	
	// Load GLB model instead of creating a cube
	var loader = new THREE.GLTFLoader();
	loader.load('https://cdn.tinyglb.com/models/2ff293225d4a4ef3878d6a631fce6dbc.glb', function(gltf) {
		probeModel = gltf.scene;
		
		// Apply initial transformations
		probeModel.position.set(0.2, 0, 0);
		probeModel.rotation.set(
			90 * Math.PI/180,
			180 * Math.PI/180,
			0
		);
		probeModel.scale.set(40, 40, 40);
		
		markerRoot1.add(probeModel);
	});
	
	// Setup slider listeners
	setupSliderListeners();
}

function update() {
	// Update AR toolkit
	if (arToolkitSource.ready) {
		arToolkitContext.update(arToolkitSource.domElement);
	}
}

function render() {
	renderer.render(scene, camera);
}

function animate() {
	requestAnimationFrame(animate);
	
	deltaTime = clock.getDelta();
	totalTime += deltaTime;
	
	update();
	render();
}

function setupSliderListeners() {
	// Position X slider
	document.getElementById('posX').addEventListener('input', function() {
		const value = parseFloat(this.value);
		if (probeModel) {
			probeModel.position.x = value;
		}
		document.getElementById('posXValue').textContent = value.toFixed(1);
	});
	
	// Position Y slider
	document.getElementById('posY').addEventListener('input', function() {
		const value = parseFloat(this.value);
		if (probeModel) {
			probeModel.position.y = value;
		}
		document.getElementById('posYValue').textContent = value.toFixed(1);
	});
	
	// Position Z slider
	document.getElementById('posZ').addEventListener('input', function() {
		const value = parseFloat(this.value);
		if (probeModel) {
			probeModel.position.z = value;
		}
		document.getElementById('posZValue').textContent = value.toFixed(1);
	});
	
	// Rotation X slider
	document.getElementById('rotX').addEventListener('input', function() {
		const value = parseInt(this.value);
		const radians = value * Math.PI/180;
		if (probeModel) {
			probeModel.rotation.x = radians;
		}
		document.getElementById('rotXValue').textContent = value;
	});
	
	// Rotation Y slider
	document.getElementById('rotY').addEventListener('input', function() {
		const value = parseInt(this.value);
		const radians = value * Math.PI/180;
		if (probeModel) {
			probeModel.rotation.y = radians;
		}
		document.getElementById('rotYValue').textContent = value;
	});
	
	// Rotation Z slider
	document.getElementById('rotZ').addEventListener('input', function() {
		const value = parseInt(this.value);
		const radians = value * Math.PI/180;
		if (probeModel) {
			probeModel.rotation.z = radians;
		}
		document.getElementById('rotZValue').textContent = value;
	});
	
	// Scale slider
	document.getElementById('scale').addEventListener('input', function() {
		const value = parseInt(this.value);
		if (probeModel) {
			probeModel.scale.set(value, value, value);
		}
		document.getElementById('scaleValue').textContent = value;
	});
}
</script>
</body>
</html>

    <div class="control-panel">
        <h3>Ultrasound Probe Controls</h3>
        
        <div class="slider-group">
            <div class="slider-label">Position X</div>
            <input type="range" min="-3" max="3" step="0.1" value="0.2" class="slider" id="posX">
            <div class="value-display" id="posXValue">0.2</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Y</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posY">
            <div class="value-display" id="posYValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Z</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posZ">
            <div class="value-display" id="posZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation X</div>
            <input type="range" min="0" max="360" step="1" value="90" class="slider" id="rotX">
            <div class="value-display" id="rotXValue">90</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Y</div>
            <input type="range" min="0" max="360" step="1" value="180" class="slider" id="rotY">
            <div class="value-display" id="rotYValue">180</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Z</div>
            <input type="range" min="0" max="360" step="1" value="0" class="slider" id="rotZ">
            <div class="value-display" id="rotZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Scale</div>
            <input type="range" min="1" max="100" step="1" value="40" class="slider" id="scale">
            <div class="value-display" id="scaleValue">40</div>
        </div>
    </div>

    <div class="control-panel">
        <h3>Ultrasound Probe Controls</h3>
        
        <div class="slider-group">
            <div class="slider-label">Position X</div>
            <input type="range" min="-3" max="3" step="0.1" value="0.2" class="slider" id="posX">
            <div class="value-display" id="posXValue">0.2</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Y</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posY">
            <div class="value-display" id="posYValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Position Z</div>
            <input type="range" min="-3" max="3" step="0.1" value="0" class="slider" id="posZ">
            <div class="value-display" id="posZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation X</div>
            <input type="range" min="0" max="360" step="1" value="90" class="slider" id="rotX">
            <div class="value-display" id="rotXValue">90</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Y</div>
            <input type="range" min="0" max="360" step="1" value="180" class="slider" id="rotY">
            <div class="value-display" id="rotYValue">180</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Rotation Z</div>
            <input type="range" min="0" max="360" step="1" value="0" class="slider" id="rotZ">
            <div class="value-display" id="rotZValue">0</div>
        </div>
        
        <div class="slider-group">
            <div class="slider-label">Scale</div>
            <input type="range" min="1" max="100" step="1" value="40" class="slider" id="scale">
            <div class="value-display" id="scaleValue">40</div>
        </div>
    </div>

    <script>
        // Get references to the model and all sliders
        const probeModel = document.getElementById('ultrasound-probe');
        
        // Position sliders
        const posXSlider = document.getElementById('posX');
        const posYSlider = document.getElementById('posY');
        const posZSlider = document.getElementById('posZ');
        
        // Rotation sliders
        const rotXSlider = document.getElementById('rotX');
        const rotYSlider = document.getElementById('rotY');
        const rotZSlider = document.getElementById('rotZ');
        
        // Scale slider
        const scaleSlider = document.getElementById('scale');
        
        // Value displays
        const posXValue = document.getElementById('posXValue');
        const posYValue = document.getElementById('posYValue');
        const posZValue = document.getElementById('posZValue');
        const rotXValue = document.getElementById('rotXValue');
        const rotYValue = document.getElementById('rotYValue');
        const rotZValue = document.getElementById('rotZValue');
        const scaleValue = document.getElementById('scaleValue');
        
        // Update position X
        posXSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            probeModel.setAttribute('position', {
                x: value,
                y: parseFloat(posYSlider.value),
                z: parseFloat(posZSlider.value)
            });
            posXValue.textContent = value.toFixed(1);
        });
        
        // Update position Y
        posYSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            probeModel.setAttribute('position', {
                x: parseFloat(posXSlider.value),
                y: value,
                z: parseFloat(posZSlider.value)
            });
            posYValue.textContent = value.toFixed(1);
        });
        
        // Update position Z
        posZSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            probeModel.setAttribute('position', {
                x: parseFloat(posXSlider.value),
                y: parseFloat(posYSlider.value),
                z: value
            });
            posZValue.textContent = value.toFixed(1);
        });
        
        // Update rotation X
        rotXSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('rotation', {
                x: value,
                y: parseInt(rotYSlider.value),
                z: parseInt(rotZSlider.value)
            });
            rotXValue.textContent = value;
        });
        
        // Update rotation Y
        rotYSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('rotation', {
                x: parseInt(rotXSlider.value),
                y: value,
                z: parseInt(rotZSlider.value)
            });
            rotYValue.textContent = value;
        });
        
        // Update rotation Z
        rotZSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('rotation', {
                x: parseInt(rotXSlider.value),
                y: parseInt(rotYSlider.value),
                z: value
            });
            rotZValue.textContent = value;
        });
        
        // Update scale (all dimensions)
        scaleSlider.addEventListener('input', function() {
            const value = parseInt(this.value);
            probeModel.setAttribute('scale', {
                x: value,
                y: value,
                z: value
            });
            scaleValue.textContent = value;
        });
    </script>
    <script>
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            // Get references to the model and all sliders
            const probeModel = document.getElementById('ultrasound-probe');
            const hitoMarker = document.getElementById('hiro-marker');
            const markerMessage = document.getElementById('marker-message');
            
            // Position sliders
            const posXSlider = document.getElementById('posX');
            const posYSlider = document.getElementById('posY');
            const posZSlider = document.getElementById('posZ');
            
            // Rotation sliders
            const rotXSlider = document.getElementById('rotX');
            const rotYSlider = document.getElementById('rotY');
            const rotZSlider = document.getElementById('rotZ');
            
            // Scale slider
            const scaleSlider = document.getElementById('scale');
            
            // Value displays
            const posXValue = document.getElementById('posXValue');
            const posYValue = document.getElementById('posYValue');
            const posZValue = document.getElementById('posZValue');
            const rotXValue = document.getElementById('rotXValue');
            const rotYValue = document.getElementById('rotYValue');
            const rotZValue = document.getElementById('rotZValue');
            const scaleValue = document.getElementById('scaleValue');
            
            // Scene and camera initialization events
            const scene = document.querySelector('a-scene');
            
            scene.addEventListener('loaded', function() {
                console.log("Scene loaded");
                document.getElementById('loading-message').style.display = 'none';
                
                scene.addEventListener('camera-init', function() {
                    console.log("Camera initialized");
                });
            });
            
            // Marker found/lost events
            if (hitoMarker) {
                hitoMarker.addEventListener('markerFound', function() {
                    console.log("Marker found");
                    markerMessage.style.display = 'none';
                });
                
                hitoMarker.addEventListener('markerLost', function() {
                    console.log("Marker lost");
                    markerMessage.style.display = 'block';
                });
            }
            
            // Fallback timeout to hide loading message
            setTimeout(function() {
                document.getElementById('loading-message').style.display = 'none';
            }, 5000);
            
            // Update position X
            if (posXSlider) {
                posXSlider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    probeModel.setAttribute('position', {
                        x: value,
                        y: parseFloat(posYSlider.value),
                        z: parseFloat(posZSlider.value)
                    });
                    posXValue.textContent = value.toFixed(1);
                });
            }
            
            // Update position Y
            if (posYSlider) {
                posYSlider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    probeModel.setAttribute('position', {
                        x: parseFloat(posXSlider.value),
                        y: value,
                        z: parseFloat(posZSlider.value)
                    });
                    posYValue.textContent = value.toFixed(1);
                });
            }
            
            // Update position Z
            if (posZSlider) {
                posZSlider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    probeModel.setAttribute('position', {
                        x: parseFloat(posXSlider.value),
                        y: parseFloat(posYSlider.value),
                        z: value
                    });
                    posZValue.textContent = value.toFixed(1);
                });
            }
            
            // Update rotation X
            if (rotXSlider) {
                rotXSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('rotation', {
                        x: value,
                        y: parseInt(rotYSlider.value),
                        z: parseInt(rotZSlider.value)
                    });
                    rotXValue.textContent = value;
                });
            }
            
            // Update rotation Y
            if (rotYSlider) {
                rotYSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('rotation', {
                        x: parseInt(rotXSlider.value),
                        y: value,
                        z: parseInt(rotZSlider.value)
                    });
                    rotYValue.textContent = value;
                });
            }
            
            // Update rotation Z
            if (rotZSlider) {
                rotZSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('rotation', {
                        x: parseInt(rotXSlider.value),
                        y: parseInt(rotYSlider.value),
                        z: value
                    });
                    rotZValue.textContent = value;
                });
            }
            
            // Update scale (all dimensions)
            if (scaleSlider) {
                scaleSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    probeModel.setAttribute('scale', {
                        x: value,
                        y: value,
                        z: value
                    });
                    scaleValue.textContent = value;
                });
            }
        });
    </script>
</body>
</html>